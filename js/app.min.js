export function initAccessibility() { const root = document.documentElement; const themeToggle = document.getElementById('theme-toggle'); if(!themeToggle) return; const saved = localStorage.getItem('theme') || 'light'; setTheme(saved, false); themeToggle.addEventListener('click', () => { const current = root.getAttribute('data-theme') === 'dark' ? 'dark' : 'light'; const next = current === 'dark' ? 'light' : 'dark'; setTheme(next, true); }); themeToggle.addEventListener('keydown', (ev) => { if (ev.key === 'Enter' || ev.key === ' ') { ev.preventDefault(); themeToggle.click(); } }); function setTheme(name, persist=true) { if (name === 'dark') { root.setAttribute('data-theme', 'dark'); themeToggle.textContent = 'â˜€ï¸'; themeToggle.setAttribute('aria-pressed', 'true'); } else if (name === 'high-contrast') { root.setAttribute('data-theme', 'high-contrast'); themeToggle.textContent = 'âš ï¸'; themeToggle.setAttribute('aria-pressed', 'true'); } else { root.setAttribute('data-theme', 'light'); themeToggle.textContent = 'ðŸŒ™'; themeToggle.setAttribute('aria-pressed', 'false'); } if (persist) localStorage.setItem('theme', name); } document.addEventListener('keydown', (ev) => { if (ev.key === 'Escape') { document.querySelectorAll('.dropdown-content').forEach(d => d.style.display = 'none'); document.getElementById('nav-links')?.classList.remove('active'); } }); document.querySelectorAll('.dropdown > a').forEach(anchor => { anchor.setAttribute('role', 'button'); anchor.setAttribute('aria-haspopup', 'true'); anchor.setAttribute('aria-expanded', 'false'); anchor.addEventListener('keydown', (ev) => { if (ev.key === 'Enter' || ev.key === ' ') { ev.preventDefault(); const content = anchor.nextElementSibling; const isOpen = content.style.display === 'block'; content.style.display = isOpen ? 'none' : 'block'; anchor.setAttribute('aria-expanded', String(!isOpen)); } }); anchor.addEventListener('click', (e) => { const content = anchor.nextElementSibling; if (content) { e.preventDefault(); const isOpen = content.style.display === 'block'; content.style.display = isOpen ? 'none' : 'block'; anchor.setAttribute('aria-expanded', String(!isOpen)); } }); }); document.body.addEventListener('keydown', (e) => { if (e.key === 'Tab') document.documentElement.classList.add('user-is-tabbing'); }); } export function init() { initAccessibility(); }